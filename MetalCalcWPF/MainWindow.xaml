<Window x:Class="MetalCalcWPF.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Управление цехом (Laser Manager)" Height="600" Width="900" WindowStartupLocation="CenterScreen">

    <Grid Margin="10">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="350"/>
            <ColumnDefinition Width="*"/>
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" BorderBrush="Gray" BorderThickness="1" CornerRadius="5" Padding="15" Margin="0,0,10,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <StackPanel Grid.Row="0" Margin="0,0,0,10">
                    <Button Content="⚙ Настройки" HorizontalAlignment="Right" Click="Settings_Click" Margin="0,0,0,10" Padding="5,2"/>

                    <TextBlock Text="Клиент / Название заказа:" FontWeight="Bold"/>
                    <TextBox x:Name="ClientBox" Height="25" Margin="0,5,0,5"/>

                    <TextBlock Text="Материал:" FontWeight="Bold" Margin="0,5,0,0"/>
                    <ComboBox x:Name="MaterialCombo" Height="25" Margin="0,5,0,5" SelectedIndex="0"/>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <StackPanel Grid.Column="0" Margin="0,0,5,0">
                            <TextBlock Text="Толщина (мм):" FontWeight="Bold"/>
                            <TextBox x:Name="ThicknessBox" Height="25" Margin="0,5,0,0"/>
                        </StackPanel>
                        <StackPanel Grid.Column="1" Margin="5,0,0,0">
                            <TextBlock Text="Количество (шт):" FontWeight="Bold"/>
                            <TextBox x:Name="QuantityBox" Height="25" Margin="0,5,0,0" Text="1"/>
                        </StackPanel>
                    </Grid>

                    <TextBlock Text="Габариты одной детали (мм):" FontWeight="Bold" Margin="0,10,0,0"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>

                        <StackPanel Grid.Column="0">
                            <TextBlock Text="Ширина X:" FontSize="10" Foreground="Gray"/>
                            <TextBox x:Name="WidthBox" Height="25"/>
                        </StackPanel>

                        <TextBlock Grid.Column="1" Text="x" VerticalAlignment="Bottom" Margin="10,0,10,5" FontWeight="Bold"/>

                        <StackPanel Grid.Column="2">
                            <TextBlock Text="Высота Y:" FontSize="10" Foreground="Gray"/>
                            <TextBox x:Name="HeightBox" Height="25"/>
                        </StackPanel>
                    </Grid>
                </StackPanel>

                <TabControl Grid.Row="1" Margin="0,0,0,10">

                    <TabItem Header="🔥 Лазер">
                        <StackPanel Margin="10">
                            <TextBlock Text="Длина контура (метров):"/>
                            <TextBox x:Name="LengthBox" Height="25" Margin="0,5,0,10"/>
                            <TextBlock Text="Введите длину реза одной детали" FontSize="10" Foreground="Gray"/>
                        </StackPanel>
                    </TabItem>

                    <TabItem Header="📐 Гибка">
                        <StackPanel Margin="10">
                            <CheckBox x:Name="IsBendingEnabled" Content="Учитывать гибку в расчете" IsChecked="False" FontWeight="Bold" Margin="0,0,0,10"/>

                            <TextBlock Text="Количество гибов (на 1 деталь):"/>
                            <TextBox x:Name="BendsCountBox" Height="25" Margin="0,5,0,10" Text="0"/>

                            <TextBlock Text="Длина линии гиба (мм):"/>
                            <TextBox x:Name="BendLengthBox" Height="25" Margin="0,5,0,10" Text="0"/>
                            <TextBlock Text="Влияет на стоимость (до 1.5м / до 3м / до 6м)" FontSize="10" Foreground="Gray" Margin="0,-5,0,10"/>

                            <Border BorderBrush="Gray" BorderThickness="1" CornerRadius="3" Padding="5" Background="#F0F0F0">
                                <StackPanel>
                                    <TextBlock Text="Техническая информация:" FontWeight="Bold" FontSize="10"/>
                                    <TextBlock x:Name="BendInfoLabel" Text="Выберите толщину..." FontSize="11" Foreground="Blue"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </TabItem>

                    <TabItem Header="🏗️ Сварка">
                        <StackPanel Margin="10">
                            <TextBlock Text="Длина шва (см):"/>
                            <TextBox x:Name="WeldLengthBox" Height="25" Margin="0,5,0,10" Text="0"/>

                            <CheckBox x:Name="IsWeldingEnabled" Content="Учитывать сварку" IsChecked="False" FontWeight="Bold"/>
                        </StackPanel>
                    </TabItem>

                </TabControl>

                <StackPanel Grid.Row="2">
                    <Button Content="Рассчитать всё" Height="45" Click="Button_Click" Background="#4CAF50" Foreground="White" FontSize="14" FontWeight="Bold"/>
                    <TextBlock x:Name="ResultLabel" Text="Итого: 0 ₸" FontSize="26" FontWeight="Bold" Margin="0,15,0,0" Foreground="#2E7D32" HorizontalAlignment="Center"/>
                    <TextBlock x:Name="ResultDetails" Text="" FontSize="11" Foreground="Gray" TextWrapping="Wrap" Margin="0,5,0,0"/>
                </StackPanel>
            </Grid>
        </Border>

        <GroupBox Grid.Column="1" Header="История расчетов" Margin="0,0,0,10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <Button Grid.Row="0" Content="📊 Скачать в Excel" HorizontalAlignment="Right" 
                        Width="120" Height="25" Margin="0,5,5,5" 
                        Click="ExportToExcel_Click" Background="#E0F7FA"/>

                <DataGrid Grid.Row="1" x:Name="HistoryGrid" AutoGenerateColumns="False" IsReadOnly="True" CanUserAddRows="False">
                    <DataGrid.ContextMenu>
                        <ContextMenu>
                            <MenuItem Header="🗑 Удалить строку" Click="DeleteOrder_Click"/>
                        </ContextMenu>
                    </DataGrid.ContextMenu>
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="№" Binding="{Binding Id}" Width="30"/>
                        <DataGridTextColumn Header="Дата" Binding="{Binding CreatedDate, StringFormat=\{0:dd.MM HH:mm\}}" Width="90"/>
                        <DataGridTextColumn Header="Тип" Binding="{Binding OperationType}" Width="60" FontWeight="Bold"/>
                        <DataGridTextColumn Header="Клиент" Binding="{Binding ClientName}" Width="*"/>
                        <DataGridTextColumn Header="Инфо" Binding="{Binding Description}" Width="100"/>
                        <DataGridTextColumn Header="Сумма" Binding="{Binding TotalPrice, StringFormat=\{0:N0\} ₸}" Width="70" FontWeight="Bold"/>
                    </DataGrid.Columns>
                </DataGrid>
            </Grid>
        </GroupBox>
    </Grid>
</Window>